In this section we gather results relating to how norms on fields behave under finite extension, maps between discrete valuation rings, and normalisations of rings of integers. 

\begin{definition}
	A \emph{discrete valuation ring (\gls{DVR})} is a local ring that is also a principal ideal domain. 
\end{definition}

So discrete valuation rings are one dimensional local rings. 
In particular, for regular or normal schemes, the local ring at a point of codimension $1$ is a DVR.
If $R$ is a DVR with maximal ideal $\mathfrak{m} $, then $\mathfrak{m} $ is generated by one element. 

DVRs get their name because there is a canonical valuation on them. 
\begin{definition}
	Let $R$ be a DVR with maximal ideal $\mathfrak{m}$. 
	Then we define \[
		v(a) = \max \{n \in \Z_{\ge 0 } \st a \in \mathfrak{m} ^{n} \} 
	,\] 
	for all $a \in R, a \ne 0$. 
\end{definition}
It is a good exercise to check that this is a well defined valuation. 
\begin{definition}
	Let $R$ be a DVR, and $\pi \in R$ such that $\mathfrak{m}  = (\pi)$. 
	Then $\pi$ is called a \emph{uniformiser of $R$}. 
\end{definition}
It is clear that the uniformiser $\pi$ is unique up to multiplication by a unit in $R$. 
\begin{remark}
	In the definition above we see that $v(\pi) = 1$. 
	This is the usual convention, but sometimes $v$ might be scaled differently. 
\end{remark}

\begin{lemma}
	Let $K$ be a field, equipped with a discrete valuation $v$. 
	Then its valuation ring $K^{\circ} = \{a \in K\st v(a) \ge 0\} $ is a DVR. 
\end{lemma}
\begin{proof}
	Any element $a \in K^{\circ} \setminus K^{\circ \circ} $ has $v(a) = 0$. 
	So $v(a^{-1}) = 0$, thus $a \in K^{\circ}$ as well. 
	So  $a$ is a unit of $K^{\circ}$. 
	From this it follows that $K^{\circ\circ}$ is a unique maximal ideal. 
	
	It remains to show that $K^{\circ \circ }$ is principal.  
	Let $\pi$ be element in ${K^{\circ \circ}}$ of minimal valuation. 
	Let $a$ be any non-zero element in $K^{\circ \circ}$. 
	Then $v(a/ \pi) = v(a) - v(\pi) \ge 0$ by the minimality assumption on $\pi$. 
	Thus $a / \pi \in K^{o}$ and $a \in (\pi)$. 
	So $(\pi) = K^{\circ \circ} $. 
\end{proof}

Conversely a DVR  $R$ is always the valuation ring of its field of fractions $\mathrm{Frac}(R)$. 
The spectrum of a DVR consists just of two points, the generic point, and the unique closed point, with residue fields $\mathrm{Frac}(R)$ and $R / \mathfrak{m} $ respectively. 

\begin{definition}
	Let $A, B$ be DVRs with maximal ideals $\mathfrak{m}_A, \mathfrak{m} _B$ and valuations $v_A, v_B$ respectively.
	Let $f: A \to B$ be a local ring morphism (i.e. $f^{-1}(\mathfrak{m} _B) = \mathfrak{m} _A)$), then the \emph{ramification index of $f$} or the \emph{ramification index of $B$ over $A$} is the number \[
		e_f = e_{B / A}= \frac{v_B(f(\pi))}{v_B(\tau)}
	,\] 
	where $\pi, \tau$ are uniformiser for $A, B$ respectively. 
\end{definition}

\begin{definition}
	Let $K$ be a discretely valued field and $L$ a finite extension of $K$, such that the valuation on $L$ extends the valuation on $K$. 
	Then the \emph{ramfication degree of  $L$ over  $K$} is the ramification index of the induced map between valuation rings, or equivalently it is 
	\[
	e_{L / K}  = \frac{v_L(\pi)}{v_L(\tau)}	,\] 
	where $\pi, \tau$ are uniformiser of $K, L$ respectively. 
\end{definition}

It is easy to see that the ramification index of a map between DVRs / discretely valued fields, $f: A \to B$ can be computed as $v_B(f(a)) / v_A(a)$ where $a$ is any element of $A$ with nonzero valuation, if the valuations are scaled such that the valuation of a uniformiser is 1. 

\begin{lemma}\label{lem:multiplicative_ramification_degree}
	Let $A \xrightarrow f B \xrightarrow g C$ be local maps of DVRs (or discretely valued fields) with respective valuations $v_A, v_B, v_C$. 
	Then $e_{g \circ f} = e_g \cdot e_f$.
\end{lemma}
\begin{proof}
	Let $\pi_A, \pi_B, \pi_C$ be uniformisers for $A, B, C$ respectively. 
	For the sake of simplicity we may assume that all valuations are scaled such that the valuations of their uniformisers are $1$.  
	Then 
	\[
		e_{g \circ f} = v_C(g(f(\pi_A)) = e_g \cdot  v_B(f(\pi_A)) = e_g\cdot e_f
	.\] 
\end{proof}

\begin{definition}
	Let $f: A \to B$ be a local map between DVRs. 
	Let $k, \ell$ be the residue fields of $A, B$ respectively and $p = \ch k$.
	Let $e$ be the ramification index of $f$.
	Then if
	\begin{itemize}
		\item $e = 1$, and $\ell / k$ is separable then $f$ is \emph{unramified}, 
		\item $e > 1$, then $f$ is \emph{ramified},
	\end{itemize}
	Moreover, if $f$ is ramified, $p \nmid e$ and $\ell / k$ is separable, then $f$ is \emph{tamely ramified}. 
	If $p \mid e$, $f$ is said to be \emph{wildly ramified}. 
\end{definition}
As we will see later in this thesis, morphisms between DVRs with tame ramification are much better behaved than those with wild ramification. 

\begin{lemma}\label{lem:generator_canonical_bundle_DVR}
	Let $f: A \into B$ be a map of DVRs with respective fraction fields $K, L$ and residue fields $k, \ell$ such that $\ell / k$ and $K / L$ are finite separable extension. 
	Let $\pi$ be a uniformiser of $B$. 
	Then $d(\pi)$ is a generator of $\Omega_{B / A}$. 
\end{lemma}
\todo{fix this lemma}
\begin{proof}
	Any element $b \in B$ can be written as $b = u \cdot \pi^{n} $ for some unit $u \in B$ and $n \ge 0$. 
	Let $f = \sum_{i = 0}^{n}  a_i x^{i} \in K[x]$ be a monic polynomial such that $f(u) = 0, f'(u) \ne 0$. 
	Then  \[
		0 = v(u^{n}) = v\left(- \sum_{i = 0}^{n-1}\right) \le v(a_i u^{i}) = v(a_i) 
	.\] 
	So $f \in A[x]$. 
	Then we compute differentials \[
		0 = d(0) = d(f(u)) = f'(u) d(u)
	.\] 
	As $f'(u) \ne 0$ we find $d(u)$ must be zero. 
	Thus \[
		d(b) = d(u\cdot \pi^{n}) = \pi^{n}\cdot d(u) + u\cdot  n \pi^{n-1}d(\pi) = un\pi^{n-1} d(\pi)
	.\] 
	So we find that $d(b)$ is a multiple of $d(\pi)$. 
	The result now follows because $\Omega_{B / A}$ is generated by $\{d(b) \st b \in B\} $.  
\end{proof}
\nomenclature{$\Omega_{X / Y}$}{The relative sheaf of KÃ¤hler differentials of a morphism of schemes $X \to Y$}

The following lemma shows that computing the normalization of a DVR $R$ in a field $L$, is really the same as finding all the valuations on $L$ that extend the valuation on $R$. 
\begin{lemma}\label{lem:normalisation_extension_norm}
	Let $K$ be a discretely valued field with valuation $v$, such that $R = K^{\circ}$ is Nagata. 
	Let $L$ be a finite extension of $K$ and $R'$ be the normalisation of $R$ in $L$. 
	Then there is a natural bijection between the maximal ideals of $R'$ and the extensions $v $ to $L$. 
\end{lemma}
\begin{proof}
	As normalisation is finite (\stacks{0AVK}) and local we know that $R'$, as a scheme consists of a generic point with fraction field is $L$, and a finite number of closed points, corresponding to maximal ideals $\mathfrak{m}_1, \ldots, \mathfrak{m} _n $ in $R'$. 
	Let $x_1, \ldots, x_n$ be the corresponding closed points in $\spec R'$. 
	Then $\mathcal{O}_{x_i, \spec R'}$ is a DVR with fraction field $L$, and thus induces a valuation on $L$. 
	We easily see that (with correct scaling) this valuation extends the valuation on $K$. 

	Conversely, let $v_L$ be a valuation on $L$ extending the valuation on $K$. 
	Let $b$ be an element in $R'$, and $f = \sum_{i = 0}^{r} a_i t^{i}$ be a monic polynomial in $R[t]$ such that $f(b) = 0$. 
	Then \[
		rv_L(b) = v_L(a^{b}) = v_L \left(-\sum_{i = 0}^{r-1} a_i b^{i}\right) \ge \min_{i} v(a_i) + iv_L(b)
	.\] 
	From this it follows that $v_L(b) \ge 0$. 
	So $R' \subset L^{o}$.  

	Let $\mathfrak{p}  = \{a \in R' \st v_L(a) > 0\} $, which we see to be non-empty and different from $(0)$. 
	Then clearly $\mathfrak{p} $ is a prime ideal.
	Indeed for $a, b \in R$  such $v(a \cdot b) = v(a) + v(b) > 0$, we find either $v(a) > 0$ or $v(b) > 0$, $a, b \in L^{o}$. 
	As $R \to R'$ is finite, we obtain that $\mathfrak{p} $ is a maximal ideal of $R$. 
\end{proof}

\begin{lemma}
	Let $K$ be a complete discretely valued field and $L$ be a finite extension of $K$.	Let $R = K^{o}$  be the value field of $K$ and $R'$ be the normalisation of $R$ in $L$. 
	Then $R' = L^{o}$. 
\end{lemma}
\begin{proof}
	These maximal ideals induce different discrete valuations on $R'$ that, which extend to different valuations on the fraction field $L$. 
	As the extension of the norm to $L$ is unique (\cref{thm:norm_finite_field_ext}) we see that $R'$ has exactly one maximal ideal $\mathfrak{m}_{R'}$. 
	In particular the valuation induced by $\mathfrak{m}_{R'} $ is the same as the one induced by $L^{oo} \subset L^{o}$. 
	So both $R'$ and $L^{o}$ are the rings of all elements with non-negative valuation in $L$. 
\end{proof}

Complete local DVRs have another nice property. They satisfy a version of Hensel's lemma. 
\begin{lemma}
	Let $R$ be a complete DVR. 
	Then $R$ is a hensilian ring.
	That means that for any monic polynomial $f \in R[x]$ and  $a \in k$, such that $\overline{f}(a) = 0$ and $\overline{f'}(a)$, there is a element $b \in R$ such that $f(b) = 0$ and $\overline{b} = a$.
	Here $k$ is the residue field of $R$ and $\overline{b}, \overline{f}$ are images in of $b, f$ in $k, k[x ]$ respectively. 
\end{lemma}
\begin{proof}
	See \stacks{04GE}.
\end{proof}


\begin{proposition}\label{prop:balancing_valuations}
	Let $K$ be a discretely valued field with valuation $v_K$,  value ring $R$ and residue fields $k$. 
	Let $L$ be a finite extension of $K$ and $v_1, \ldots, v_n$ be the extensions of $v_R$ to $L$. 
	Let $L_1^{o}, \ldots, L_n^{o}$ be the value rings of $L$ equipped with the norms $v_1, \ldots, v_n$ respectively, and let $\ell_1, \ldots, \ell_n$ be their respective residue fields. 
	Then \[
		[L: K] = \sum_{i= 1}^{n} e_{L_i^{o} / R} \cdot [\ell_i: k]
	.\] 
\end{proposition}
\begin{proof}
	Let $\mathfrak{m} = (\pi) $ be the maximal ideal of $R$
	Let $R'$ be the normalisation of $R$ in $L$. 
	Then this is exactly \stacks{09E8}.
\end{proof}

Sometimes it is useful to turn a discretely valued field into a valued field with algebraically closed residue field, without changing the value group, as taking the algebraic closure would do. 
For this the following notion is right. 
\begin{definition}
	Let $K$ be a discretely valued field. 
	Then we write $K^{\text{un}}$ for a maximally unramified extension of $K$. 
\end{definition}
If $K$ is complete, then $K^{\text{un}}$ might no longer be complete. But we can resolve this by simply considering $\hat{K^{\text{un}}}$. 
 
