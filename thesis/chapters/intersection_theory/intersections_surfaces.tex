Let $X$ be regular Noetherian integral scheme of dimension 2. 
Given two curves $F, G$ on $X$, it is a natural question to ask how often $F$ and $G$ intersect and in what points. 
This is subject of intersection theory. 

\begin{definition}
	Suppose $D, E$ are effective Cartier divisors on $X$ that do not share any irreducible components, cut out by the sheaf of ideals $\mathcal{I} _D, \mathcal{I} _E$ respectively.

	Let $x \in X$ be closed point. Then the \emph{intersection number of $D, E$ in $x$} is \[
		i_x(D, E) = \length_{\mathcal{O}_{X, x}} \frac{\mathcal{O}_{X, x}}{\mathcal{I}_{D,x} + \mathcal{I}_{E,x}} 
	.\]  
\end{definition}
\nomenclature[intersection]{$i_x(D, E)$}{The intersection number of $D, E$ in $x$}
\nomenclature[lenght]{$\length_{A} M$}{The length of the $A$-module $M$}

This functions counts how many times $ D$ and $E$ intersect in $x$. 
As you may expect when  $x$ not in the support of $D$ (resp. $E$), then $i_x(D, E) = 0$. 
Indeed, in that case the inclusion $\mathcal{I}_{D, x} \subset  \mathcal{O}_{X, x}$ (resp. $\mathcal{I} _{E, x}\subset \mathcal{O}_{X,x}$) is an isomorphism. 
Hence $\mathcal{I}_{D, x} + \mathcal{I} _{E, x} = \mathcal{O}_{X, x}$ and $i_x(D, E) = \length \mathcal{O}_{X, x} /\mathcal{O}_{X, x} = 0$. 

If $x \in \supp D \cap \supp E$ then by the Nullstellensatz we have that $\mathfrak{m} _x \subset  \sqrt{\mathcal{I} _{D, x} + \mathcal{I} _{E, x}} $. 
Hence $\frac{\mathcal{O}_{X, x}}{\mathcal{I}_{D,x} + \mathcal{I}_{E,x}}$ is Artinian, thus $i_x(E, D)$ is finite and nonzero. 

\begin{definition}\label{def:intersection_number_effective}
	Let $D, E$ be effective Cartier divisors on $X$ that do not share any irreducible components.
	Then we define the \emph{intersection number of $D, E$} to be \[
		D\cdot E = \sum_{x \in X_\text{cl} }i_x (D, E)[\kappa(x): k]
	.\] 
\end{definition}
\nomenclature[intersection]{$D \cdot E$}{The intersection number of $D$ and $E$}
As $\supp D \cap \supp E$ is finite, the terms in the sum above are $0$ for all but finitely many points. Hence $D\cdot E$ is a finite integer. 

Sometimes it makes sense to keep track in which points the components intersect with what degree. In that case the following definition is useful. 
\begin{definition}
	Let $D, E$ as above. 
	Then we define \[
		D.E = \sum_{x \in X_\text{cl} } i_x(D, E)[\kappa(x) :k] [x]
	\] 
	which lays in the free abelian group generated by the closed points of $X$.
\end{definition}
Note that in the definition above we used a lower dot, and not a central dot as in \cref{def:intersection_number_effective}.
\begin{example}
	Let $F$ be any field and $X = \spec F[x, y]$. 
	Let  $D = V(y)$ and $E = V(y - x^r)$ for some $r \ge 1$.
	Then  $\supp D \cap \supp E = \{(0, 0)\} $ and $\mathcal{I} _{D, (0,0)} + \mathcal{I} _{E, (0,0)} = (y, y-x^r) = (y, x^r)$.
	So \[
		i_{(0,0)}(D, E) = \length \frac{K[x, y]_{(0, 0)}}{(y, x^{r})} = r
	.\] 
	As this is the only intersection point, we also have that $D\cdot E = r$. 
\end{example}

\begin{lemma}\label{lem:intersection_surfaces_restriction_mult_1}
	Let $D, E$ be effective Cartier divisors with no common components. And let $i: D \into X, j: E \into X$ be the corresponding closed immersions in $X$. 
	Let $x \in E$. Then  
	\begin{align*}
		i_x(D, E) &= \mult_x D|_E   \\
		(D\cdot E) &= \deg D|_E 
	.\end{align*}
\end{lemma}
\begin{proof}
	The second equality follows from the first so it is sufficient to show that $i_x(D, E) = \mult_x D|_E$. 
	Then $(D\cdot E) =\deg D|_E$ follows from the definition of the degree.  
	We have \[
		i_x(D, E) = \length \frac{\mathcal{O}_{X, x}}{\mathcal{I} _{D, x} + \mathcal{I} _{E, x}} =\length \frac{\mathcal{O}_{E, x}}{\mathcal{O}(-D|_E)_x} = \mult_x D|_E \\
	.\] 
\end{proof}
\begin{lemma}
	Let $D, F$ be effective Cartier divisors that do not share any components with a effective Cartier divisor $E$. Let $x \in E$
	Then  \[
		i_x (D + F, E) = i_x(D, E) + i_x(F, E), \quad (D + F) \cdot E = D\cdot E + F \cdot E
	.\] 
\end{lemma}
\begin{proof}
	Using \cref{lem:intersection_surfaces_restriction_mult_1} we see that 
	\begin{align*}
		i_x (D + F, E) &= \mult_x (D + F)|_E = \mult_x (D|_E + F|_E) \\
			       &= \mult_x D|_E + \mult_x F|_E \\
			       &= i_x(D + F, E) 
	.\end{align*}
	From this $(D + F) \cdot E = D\cdot E + F \cdot E$ follows.
\end{proof}
\nomenclature[multiplicity]{$\mult_F (D)$}{The multiplicity of a prime divisor $F$ in the divisor $D$}


\begin{definition}
	Let $D, E$ be divisors (not necessarily effective) without common components. 
	Let $E = E_1 - E_2$ and $D = D_1 - D_2$ such that $E_1, E_2, D_1, D_2$ are effective divisors with pairwise no common components. 
	Then we can extend \cref{def:intersection_number_effective} 
	\[
	D\cdot E = D_1 \cdot E_1 - D_2 \cdot E_1 - D_1 \cdot E_2 + D_2 \cdot  E_2
	.\] 
	The map $(D, E )\mapsto D\cdot E$ is bilinear where it is defined and is called the \emph{intersection pairing}.
\end{definition}

To extend the set of pairs of divisors on which the intersection pairing is defined, as well as prove nice properties of it, we need to put extra assumptions on the scheme $X$. 
\begin{example}\label{ex:fail_intersection_pairing_linear}
	It would be favorable if the intersection pairing was invariant under linear equivalence of divisors, i.e.\ $E\cdot D = E\cdot D'$ for $D \sim D'$, both with no components common to $E$. 
	Alas, this is not the case for general $X$. 
	Let $X = \aff_K^{2}$ and led $D = V(x), D' = V(y), E = V(y-1)$. 
	Then $D\cdot E = 1$ as they intersect once in $(0, 1)$, but $D' \cdot E = 0$ as they are parallel lines. 
	Intuitively what has happened is that the intersection of $D, E$ has moved outside of $\aff_K^2$ to a point in $\pro^{2}_K \setminus \aff_{K}^2$. 
	So the intersection point is hidden, because $\aff_K^2$ does not have enough points. 
	The solution to this will be to assume that $X$ is proper. 
\end{example}


\begin{lemma}[moving lemma]\label{lem:moving_lemma}
	Let $X$ be a connected, normal, separated, Noetherian scheme, and $D, E$ divisors on $X$. 
	Then there is a $f \in K(X)$ such that $D + (f)$ and $E$ do not share any components. 
\end{lemma}
\begin{proof}
	See \cite[cor.\ 9.1.10]{liuAlgebraicGeometryArithmetic2002}
\end{proof}

\begin{lemma}\label{lem:proper_trivial_bundle_pairing}
	Suppose that moreover $X$ is proper. 
	Let  $D$ be any divisor and $f \in K(X)$ be such that $D$ and $(f)$ do not share any components. 
	Then $(f)\cdot D = 0$. 
\end{lemma}
\begin{proof}
	By the linearity of the intersection pairing we may assume that $D$ is effective. 
	Then $ i: D \into X$ is a closed immersion, thus $D$ is proper as well. By \cref{lem:intersection_surfaces_restriction_mult_1} we know that \[
		(f)\cdot D = \deg (f)|_D = \deg (i^* f) = 0
	.\] 
	As $i^* f \in K(D)$ and $D$ is proper. 
\end{proof}
\begin{definition}
	Let $X$ be a scheme. Then we write $\divisor X$ for the group of Weil divisors on $X$.
	If  $X$ is an $R$-scheme then we write $\divisor_s X$ for the group of Weil divisors on $X$ with support in $X_s$. 
\end{definition}
\nomenclature[div]{$\div X$}{The group of divisors on $X$}

\begin{proposition}\label{prop:intersection_pairing_proper_model}
	If $X$ is proper, connected, normal, Noetherian then the intersection pairing extends to a symmetric bilinear map $\divisor X \times  \divisor X \to \Z$. 
	Moreover if $D\sim D'$ are linearly equivalent, then $(D, E) = (D', E)$.
\end{proposition}
\begin{proof}
	For the first part we only have to extend the intersection pairing to pairs of divisors with common components. 
	Let $D, E$ be such components. 
	Then by \cref{lem:moving_lemma} there is a $f \in K(X)$ such that $D + (f)$ and $E$ do not share any components. 
	Then we define $D\cdot E := (D + (f))\cdot E$. 
	By \cref{lem:proper_trivial_bundle_pairing} this is independent of the choice of $f$. 

	If $D \sim D'$ then there is a $f \in K(X)$ such that $D' = D + (f)$. 
	Hence \[
		D'\cdot E = (D + (f))\cdot E = D\cdot E + (f)\cdot E = D\cdot E
	.\] 
\end{proof}



