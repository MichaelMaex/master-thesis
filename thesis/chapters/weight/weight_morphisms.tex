In this section we study how weight functions behave under morphisms, in particular finite covers of curves. 
The main result of this section, \cref{prop:weightfunction_fullback}, was already known to experts, but it is not stated in the papers we are following \cite{bakerWeightFunctionsBerkovich2016,nicaiseBerkovichSkeletaBirational2016,mustataWeightFunctionsNonArchimedean2015}, and is as far as we know not published elsewhere. 

We first need a few results on the analytification of finite maps between varieties. 

\begin{lemma}
	Let $f: X \to Y$ be a finite map between varieties over  $K$. 
Then the map $f\an: X\an \to Y\an$ is finite. 
\end{lemma}
\begin{proof}
	Let $(y, v) \in Y\an$ with $y \in Y$ and $v$ a valuation on $\kappa(y)$ as in \cref{def:berkovich_analytification_explicit_chap_6}. 
	Then \[
		{f\an}^{-1} (y, v) = \{(x, v_x) \st f(x) = y, v_x \text{ is valuation on $\kappa(x)$ that extends $v$ }  \} 
	.\]
	The number of $x \in X$ such that $f(x) = y$ is finite. 
	For any such $x$ the number of valuations on $\kappa(x)$ that extend $v$ is finite because of \cref{lem:normalisation_extension_norm} and the fact that normalisations of Nagata schemes are finite (\stacks{0335}).
\end{proof}

\begin{lemma}\label{lem:im_type_ii}
	If $f: X \to Y$ is a generically finite map between $K$-varieties and $x \in X^{\text{bir}}$. Then
	\[
		x \in X^\text{div} \iff f(x) \in Y^\text{div}
	.\] 
\end{lemma}
\begin{proof}
	The map being generically finite means that $K(X)$ is a finite extension of $K(Y)$ and that $v_{f(x)}$ is the restriction of $v_x$ to $K(Y)$. 
	Then the residue fields of $K(X), K(Y)$ wrt.\ $v_x, v_{f(x)}$ are a finite extension \stacks{09E5}, hence of the same transcendence degree over $k$. 
	The claim now follows from \cref{lem:char_div_point}.
\end{proof}
\begin{lemma}
	Let $f: X \to Y$ be a finite map and $x \in X^{\text{div}}$, $y = f(x)$, 
	then \[
		N(x) = N(y)\cdot e
	,\]
	where $e$ is the ramification degree of $\mathcal{H} (y) \to \mathcal{H} (x)$. 
\end{lemma}
\begin{proof}
	This is \cref{lem:multiplicative_ramification_degree} applied to the morphisms $\mathcal{H} (y) \to \mathcal{H} (x) \to K$.
\end{proof}
\begin{remark}
	In the case of curves we can give a more topological argument for \cref{lem:im_type_ii}. 
	A divisorial point $x \in X\an$ is precisely a point with an infinite number of tangent directions, i.e.\ a branch point.
	The map $f\an: X\an \to Y\an $ is topologically finite.
	So there are also infinitely many branches at $f(x)$, i.e.\ $f(x)$ is also such a branch point, hence divisorial. 	
\end{remark}

The following proposition will be very useful for understanding finite maps between Berkovich curves in general. 
\begin{proposition}\label{prop:balancing_finite_morphism}
	Let $g: X \to Y$ be a generically finite map between proper varieties of degree $d$ and $\phi = g\an: X\an \to Y\an$. 
	Let $y \in Y^{\text{div}}$. 
	Then 
	\[
		d = \sum_{x \in \phi^{-1}(y)}^{} e_{x} \cdot  f_{x} 
	,\] 
	where $e_x$ is the ramification degree of the induced map  $\mathcal{H} (y) \to \mathcal{H} (x)$ and $f_x = \left[\widetilde{\mathcal{H} (x)}, \widetilde {\mathcal{H} (\phi(x))}\right]$.
\end{proposition}
\question{$f$ voor de uitbreidingsgraad gebruiken is verwarrend, want dat is ook het morfisme. Wat is een ander goed symbool?}
\begin{proof}
	Let $v_y$ be the discrete valuation on $K(Y)$ associated to $y$. 
	For every $x \in \phi^{-1}(y)$ we write $v_x$ for the discrete valuation that extends $v_y$ on $K(X)$. 
	The result now follows from \cref{prop:balancing_valuations} and the observation that the ramification degree and residue fields do not change under completion. 
\end{proof}

\begin{corollary}\label{cor:balancing_galois_cover}
	Suppose that $g: X \to Y$ is a Galois cover of degree $d$ between proper varieties. 
	We write $\phi = g\an$. 
	Let $x \in X\an$. 
	Then \[
		d = |\phi^{-1}(\phi(x))| \cdot e\cdot f
	,\] 
	where $e$ is the ramification degree of $\mathcal{H} (\phi(x)) \to \mathcal{H} (x)$ , and  $f = \left[\widetilde{\mathcal{H} (x)}, \widetilde {\mathcal{H} (y)}\right]$.
\end{corollary}
\begin{proof}
	As the cover is Galois, the points in $|\phi^{-1}(\phi(x))|$ are in the same Galois orbit.
	So this follows from \cref{prop:balancing_finite_morphism} applied to $\phi(x)$ and the observation that all ramification degrees and degrees of field extensions are equal in every term. 
\end{proof}

\begin{remark}\label{rem:balancing_galois_cover}
	Suppose $g:X \to Y$ is a Galois cover of curves of degree $d$ and $d$ is prime.
	Then for any divisorial points $y \in Y\an$ we have that \[
		d = |\phi^{-1}(y)| \cdot e \cdot f
	\] 
	with $e, f$ as above. 
	Let $x \in \phi^{-1}(y)$ and $\mathscr X \to \mathscr Y$ an extension of $g$ between snc-models such that $x, y$ are vertices on the dual graphs of $\mathscr X, \mathscr Y$ respectively (we will see that this exists in \cref{lem:snc_models_morphism_curves}).
	Let $F$ be the irreducible component associated to $y$ in $\mathscr Y$ and $G$ be the irreducible component associated to $x$ in  $\mathscr X$. 
	We consider $G, F$ as $k$-curves with reduced scheme structure. 

	As $d$ is prime there are 3 possible cases. 
	\begin{itemize}
		\item $|\phi^{-1}(y)| = d$, then $e = f = 1$.  
			Then $G \to F$ is an isomorphism. 
		\item $e = d$, then $|\phi^{-1}(y)| = 1, f = 1$. 
			Then $G \to F$ is an isomorphism. 
		\item $f = d$, then $e = |\phi^{-1}(y)| = 1$. 
			Then the map $G \to F$ is of degree $d$. 
	\end{itemize}
	If $d = \ch k$ then the last case splits into two cases. 
	Either the extension $\left[\widetilde{\mathcal{H} (x)}, \widetilde {\mathcal{H} (y)}\right]$ is purely inseparable, in which case $G \to F$ is a inseperable morphism of curves, or the extension is seperable, in which case $G \to F$ is a degree $d$ cover of curves.
\end{remark}
\begin{proof}
	Let $a, b$ be the generic points of $F, G$ respectively. 
	This follows from the observation that $\kappa(a) = \widetilde{\mathcal{H} (x)}$ and likewise $\kappa(b) = \widetilde{\mathcal{H} (y)}$.
	So the map $\mathcal{H} (y) \to \mathcal{H} (x)$ is the map of function fields between the regular proper curves $F, G$. 
\end{proof}

To understand the map $\phi: X\an \to Y\an$ it would best if we could always find suitable map $\psi: \mathscr X \to \mathscr Y$ of snc-models of $X, Y$ resp.\ such that $\psi_\eta = f$. This is what the following lemma allows us to do for curves. 
\begin{lemma}\label{lem:snc_models_morphism_curves}
	Let $f: X \to Y$ be a morphism of curves. 
	Let $x \in X^{\text{div}}, y \in Y^{\text{div}}$ be divisorial points such that $\phi(x) = y$. 
	Then there are snc-models $\mathscr X$ of $X$ and $\mathscr Y$ of $Y$, which have irreducible components corresponding to $x, y$ respectively together with a map $\psi: \mathscr X \to \mathscr Y$ that extends $f$. 
\end{lemma} 
\begin{proof}
	Let $\mathscr Y$ be a snc-model of $Y$ with an irreducible component $G$ that corresponds to $y$. 
	Let $N(\mathscr Y)$ denote the normalization of $\mathscr Y$ in the function field $K(X)$. 
	Let $g: N(\mathscr Y) \to Y$ be the normalisation morphism. 
	Then we claim that $N(\mathscr Y)$ is a proper model of $\mathscr X$, but is not necessarily regular or snc. 
	
	Lets first check the generic fiber.
	As normalization is local, we see that  $N(\mathscr Y)_\eta$ is the normalization of $Y$ in $K(X)$, which is exactly $X$, as we assume that our curves are projective, connected and smooth. 
	Recall that $\mathscr Y$ is locally of finite type over $R$ which is a complete Noetherian local ring. 
	So $\mathscr Y$ is Nagata (\stacks{0335}), thus the normalisation $N(\mathscr Y) \to \mathscr Y$  is finite (\stacks{0AVK}), in particular proper. 
	So $N(\mathscr Y)$ is proper over $R$, as the composition $N(\mathscr Y) \to \mathscr Y \to \spec R$ is proper. 
	The last thing to check is that $N(\mathscr Y) \to \spec R$ is flat. It is sufficient to show that $N(\mathscr Y) \to \mathscr Y$ is flat, 
	which follows from \cite[thm.\ 18.H]{matsumuraCommutativeAlgebra1980} and the observation that $\mathscr Y$ is Cohen-Macauly (\cite[cor.\ 8.2.22]{liuAlgebraicGeometryArithmetic2002}).
	
	Let $\xi$ be the generic point of the component $G$. 
	Then the valuation of $y$ is the valuation of $\mathcal{O}_{\xi, \mathscr Y}$ extended to $K\left( Y \right) $. 
	As normalisation is local and by \cref{lem:normalisation_extension_norm}, $g^{-1}(\xi)$ are generic points of components in $N(\mathscr Y)_s$ that correspond to the points in $\phi^{-1}(y)$. 
	In particular, one of the irreducible components $F$ of $N(\mathscr Y)_s$ corresponds to $x$. 

	Let $\mathscr X$ be a snc-desingularisation of $N(\mathscr Y)$ and $\tilde F$ be the strict transform of $F$. 
	Then there is a composition of dominating maps $\mathscr X \to  N(\mathscr Y) \to \mathscr Y$.
	The component $\tilde F$ maps to $G$. So we are done. 
\end{proof}

\begin{proposition}\label{prop:pullback_log_canonincal}
	Let $f: X \to Y$ be a separable Galois cover of curves of degree $d$ and suppose that  $\ch k \nmid d$. 
	Let $\psi: \mathscr X \to \mathscr Y$ be a morphism between snc-models of $X, Y$ extending  $f$.
	Let $a, b$ be the generic points of components $F, G$ in $\mathscr X_s, \mathscr X_y$ respectively such that $F$ dominates $G$. 
	Then $h$ is an isomorphism locally around $a$. 
\end{proposition}
\begin{proof}
	The morphism $h$ is given by 
	\[
	\begin{aligned}
		\omega_{\mathscr X}^{\text{log}} &= \omega_{\sX}(\sX_{s, \text{red}} - \sX_s) \\
						 &\overset h\simeq \psi^*(\omega_{\sY}) \otimes \omega_{\sX / \sY} (\sX_{s, \text{red}} - \sX_s) \\
						 &= \psi^*(\omega_{\sY}^{\text{log}}) \otimes \omega_{\mathscr X / \sY}(\sX _{s, \text{red}} - \psi^*\sY_{s, \text{red}}) \\
	\end{aligned}
	.\] 
	Locally around $a$ map $h$ twist with the section $d\beta + (\alpha) - (\beta)$ where $\alpha, \beta$ cut out $\sX_(s, \text{red}), \sY_{s, \text{red}} $ respectively. 
	So it is sufficient to show that the multiplicity of $a$ in in $(a b^{-1}d\beta)$ is $0$.  
	This may be computed étale locally on the map $\spec \mathcal{O}_{\sX, a}^{\text{sh}} \to \spec \mathcal{O}^{\text{sh}}_{\sY, b}$. 
	Let $M, N$ be the multiplicities of $F, G$ respectively and $e = M / N$ be the ramification degree of these components. 

	We know that $\omega_{\sX / \sY}$ is generated by $d \alpha$ (\cref{lem:generator_canonical_bundle_DVR}) and that $\beta = u \alpha ^{e} $ for some unit $u$ in $\mathcal{O}_{\sX, a}^{\text{sh}}$. 
	As $\mathcal{O}_{\sX, a}^{\text{sh}}$ is hensilian, the residue field is algebraically closed and $\ch k \nmid e$ we find that $\sqrt[e]{u} $ exists, so we may assume $u =  1$. \question{dit herdefineert $\alpha$. Waarom is $\alpha$ nog steeds een generator?}
	So \[
	\beta = \alpha^{e},\quad d\beta = \alpha^{e-1}d\alpha
	.\]  
	Thus $\mult_{a} d\beta = e - 1$. 
	Then \[
		\mult_a \alpha \beta^{-1} db = e - 1 + 1 - e = 0
	.\]
\end{proof}

\begin{theorem}\label{prop:weightfunction_fullback}
	Let $f: X \to Y$ be a separable Galois cover of curves of degree $d$. 
	Suppose that $\ch k \nmid d$. 
	Let $\sigma$ be a $m$-pluricanonical form on $Y$. 
	We can interpret $f^*\sigma$ as a rational section of $\omega_{X / K}^{\otimes n}$ with possible poles along the ramification points of $f: X \to Y$. 
	Then \[
		\wt_{f^*\sigma} = \wt_{\sigma} \circ f\an
	.\] 
\end{theorem}
\nomenclature[NX]{$N(X, L)$}{The normalisation of the scheme $X$ is the field $L$}
\begin{proof}
	As weight functions are continuous on $\mathbb{H}(X), \mathbb{H}(Y)$ with respect to the metric topology and the divisorial points are dense, it is sufficient to show that $\wt_{f^* \sigma}(x) = \wt_{\sigma}(y)$ 
	for divisorial points  $x, y$ such that $\phi(x) = y$. 
	Choose a map of models $\psi: \mathscr X \to \mathscr Y$ as in \cref{lem:snc_models_morphism_curves} and let $a, b$ be the generic points of the components corresponding to $x, y $  respectively. 
	Let $e = N(x) / N(y)$ be the ramification degree of $a$ over $b$. 
	Let $\sigma_X, \sigma_Y$ be the extensions of $f_*\sigma, \sigma$ to $\omega^{\text{log}}_{\mathscr X}, \Omega^{\text{log}}_{\mathscr Y}$ respectively. 
	\Cref{prop:pullback_log_canonincal} states that $\omega^{\text{log}}_{\sX} \simeq \omega^{\text{log}}_{\sY}$. 
	So \[
		\wt_{f^* \sigma}(x) = \frac{\mult_a \sigma_X}{ N(x) } = \frac{e \mult_b \sigma_Y }{e N(y)} = \wt_{\sigma}(y)
	.\] 
\end{proof}

\begin{remark}\label{rem:weightfunction_fullback_art} 
	It turns that \cref{prop:weightfunction_fullback} can be generalized to the case where $\ch k \mid d$. 
	In this setting Art Waeterschoot identified an error term. 
	The relation becomes \[
		\wt_{f^* \omega}(x) = \wt_{\omega}(f\an (x)) + \frac{m}{N(x)} \cdot \delta_{\mathcal{H} (x) / \mathcal{H} (f\an(x))}^{\text{log}}
	,\] 
	where $\delta_{\mathcal{H} (x) / \mathcal{H} (f\an(x))}^{\text{log}}$ is the \emph{log different} which also makes an appearance in an alternative definition of weight functions in \cite{temkinMetrizationDifferentialPluriforms2016a}.
	We write $\mathfrak{d}_f $ for the continuation of $\frac{m}{N(x)} \delta_{\mathcal{H} (x) / \mathcal{H} (f\an(x))}^{\text{log}}$ to the whole of $X\an$. 
	Unfortunately giving a proof here would be outside the scope of thesis.
	We will not be using this result moving forward in the thesis. 
\end{remark}
\nomenclature[logdifferent]{$\delta_{L / K}$}{The log-different of $L$ over $K$}



